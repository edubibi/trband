<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE rESEARCH BAND - Player</title>
    <style>
        :root {
            --primary: #ffffff;
            --secondary: #a0a0a0;
            --accent: #ff4757;
            --bg-glass: rgba(255, 255, 255, 0.1);
            --shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.37);
        }
        body {
            margin: 0; font-family: 'Segoe UI', system-ui, sans-serif;
            background: #1a1a2e; color: white; min-height: 100vh;
            display: flex; align-items: center; justify-content: center; overflow: hidden;
            flex-direction: column; /* For footer */
        }
        .bg-layer {
            position: fixed; top: -10%; left: -10%; width: 120%; height: 120%;
            background: url('PORTADA%20DISCO%20LP%20JAZZ1.png') no-repeat center center;
            background-size: cover; filter: blur(40px) brightness(0.4); z-index: -1;
        }
        
        /* Main Container */
        .player-container {
            background: var(--bg-glass); backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.18);
            border-radius: 20px; box-shadow: var(--shadow);
            width: 90%; max-width: 1000px; height: 80vh;
            display: flex; overflow: hidden; animation: fadeIn 1s ease;
            position: relative;
        }
        @keyframes fadeIn { from { opacity: 0; translateY(20px); } to { opacity: 1; translateY(0); } }

        /* Left Side */
        .now-playing {
            flex: 1; padding: 40px; 
            display: flex; flex-direction: column;
            align-items: center; justify-content: center; background: rgba(0,0,0,0.2);
            text-align: center; position: relative;
        }
        
        /* Branding moved inside left column */
        .brand-header {
            width: 100%; display: flex; align-items: center; justify-content: center;
            margin-bottom: 30px; /* Space between logo and art */
        }
        .brand-logo { height: 50px; margin-right: 12px; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.5)); }
        .brand-title { font-size: 1.2rem; font-weight: 700; text-transform: uppercase; letter-spacing: 2px; text-shadow: 0 2px 10px rgba(0,0,0,0.5); }

        .album-art {
            width: 240px; height: 240px; border-radius: 15px; background: #000;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5); margin-bottom: 25px; object-fit: cover;
            transition: transform 0.3s ease;
        }
        .album-art.playing { animation: pulse 2s infinite; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
        
        .track-info h2 { margin: 0; font-size: 1.3rem; font-weight: 600; }
        .track-info p { margin: 5px 0 20px; color: var(--secondary); font-size: 0.9rem; }
        
        .controls { width: 100%; display: flex; flex-direction: column; gap: 15px; }
        audio { width: 100%; outline: none; margin-top: 10px; }
        .buttons { display: flex; justify-content: center; gap: 20px; margin-top: 10px; }
        .btn { background: none; border: none; color: white; cursor: pointer; font-size: 1.5rem; transition: color 0.2s; }
        .btn:hover { color: var(--accent); }
        .btn-main { font-size: 2.5rem; }

        /* Right Side */
        .playlist-panel {
            flex: 1; background: rgba(0,0,0,0.1); display: flex; flex-direction: column;
            border-left: 1px solid rgba(255,255,255,0.05); padding-top: 20px;
        }
        .playlist-header {
            padding: 20px; background: rgba(0,0,0,0.2);
            border-bottom: 1px solid rgba(255,255,255,0.05);
            display: flex; flex-direction: column; gap: 10px;
        }
        
        .tabs { display: flex; gap: 10px; margin-bottom: 5px; }
        .tab {
            flex: 1; padding: 8px; border: none; background: rgba(255,255,255,0.05);
            color: var(--secondary); cursor: pointer; border-radius: 6px; font-weight: 600;
        }
        .tab.active { background: var(--accent); color: white; }
        
        .search-row { display: flex; gap: 10px; }
        #searchInput {
            flex: 1; padding: 10px; border-radius: 8px; border: none;
            background: rgba(255,255,255,0.1); color: white; outline: none;
        }
        .action-btn {
            padding: 10px; border-radius: 8px; background: rgba(255,255,255,0.1);
            color: white; border: none; cursor: pointer; display: flex; align-items: center; justify-content: center;
        }
        .action-btn:hover { background: rgba(255,255,255,0.2); }

        .track-list { list-style: none; padding: 0; margin: 0; overflow-y: auto; flex: 1; }
        .track-item {
            padding: 12px 20px; border-bottom: 1px solid rgba(255,255,255,0.03);
            cursor: pointer; display: flex; align-items: center; gap: 15px; transition: background 0.2s;
        }
        .track-item:hover { background: rgba(255,255,255,0.05); }
        .track-item.active { background: rgba(255,255,255,0.1); border-left: 4px solid var(--accent); }
        .track-name { font-weight: 500; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; flex: 1; }
        
        /* Author Footer */
        .author-footer {
            margin-top: 15px; font-size: 0.8rem; color: rgba(255,255,255,0.4);
            letter-spacing: 1px; text-transform: uppercase;
        }
        
        .add-btn { 
            width: 30px; height: 30px; border-radius: 50%; border: none; 
            background: rgba(255,255,255,0.1); color: white; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
        }

        /* Mobile */
        @media (max-width: 768px) {
            .player-container { flex-direction: column; height: 90vh; overflow-y: auto; }
            .brand-header { margin-bottom: 20px; }
            .now-playing { padding: 20px; min-height: auto; }
            .album-art { width: 180px; height: 180px; margin-bottom: 15px; }
        }
    </style>
</head>
<body>
    <div class="bg-layer"></div>
    
    <div class="player-container">
        
        <!-- PLAYER (Left Side) -->
        <div class="now-playing">
            <!-- Branding Inside -->
            <div class="brand-header">
                <img src="logo_trb.png" class="brand-logo">
                <div class="brand-title">THE rESEARCH BAND</div>
            </div>

            <img src="PORTADA%20DISCO%20LP%20JAZZ1.png" class="album-art" id="coverDisplay" onerror="this.src='https://via.placeholder.com/300/000000/FFFFFF?text=Music'">
            <div class="track-info">
                <h2 id="trackTitle">Selecciona una canci√≥n</h2>
                <p id="trackArtist">Mis Discos</p>
            </div>
            <div class="controls">
                <audio id="audioPlayer" controls></audio>
                <div class="buttons">
                    <button class="btn" onclick="prevTrack()">‚èÆ</button>
                    <button class="btn btn-main" onclick="togglePlay()">‚èØ</button>
                    <button class="btn" onclick="nextTrack()">‚è≠</button>
                </div>
            </div>
        </div>

        <!-- PLAYLIST (Right Side) -->
        <div class="playlist-panel">
            <div class="playlist-header">
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('all')" id="tabAll">üìö Biblioteca</button>
                    <button class="tab" onclick="switchTab('fav')" id="tabFav">‚≠ê Mi Playlist <span id="favCount">(0)</span></button>
                </div>
                <div class="search-row">
                    <input type="text" id="searchInput" placeholder="üîç Buscar..." onkeyup="filterPlaylist()">
                </div>
                <div class="search-row" id="importRow">
                    <label for="fileInput" class="action-btn" title="A√±adir Local" style="flex:1">üìÇ A√±adir</label>
                    <button class="action-btn" onclick="searchWeb()" title="Buscar en Web" style="flex:1">üåê Web</button>
                </div>
                <input type="file" id="fileInput" multiple accept="audio/*" style="display:none" onchange="importFiles(this)">
            </div>
            <ul class="track-list" id="playlist"></ul>
        </div>
    </div>
    
    <div class="author-footer">Autor: Eduardo Ram√≠rez de Cartagena</div>

    <script>
        let fullPlaylist = ["01Medianoche-en-la-Terraza.mp3", "All around if you want.mp3", "Black and grey .mp3", "Close yours feelings (Extend) .mp3", "Groove or not.mp3", "Heaven_s Glow.mp3", "Man island beach.mp3", "Meanwhile_I_Love_you_44.mp3", "Saxo by the clouds.mp3", "Saxophone Serenade.mp3", "Secret-of-Velvet.mp3", "Sharp-echoes.mp3", "Soft-corners.mp3", "Voices for dreams.mp3", "Woman on the island beach.mp3"].map(f => ({
            name: f.replace(/\.[^/.]+$/, "").replace(/_/g, " "),
            url: encodeURIComponent(f),
            original: f
        }));
        
        let myPlaylist = []; 
        let currentMode = 'all'; 

        const audioPlayer = document.getElementById('audioPlayer');
        const playlistEl = document.getElementById('playlist');
        const trackTitle = document.getElementById('trackTitle');
        const coverDisplay = document.getElementById('coverDisplay');
        const searchInput = document.getElementById('searchInput');
        const favCount = document.getElementById('favCount');
        
        let currentIndex = -1;
        let activeQueue = [];

        function switchTab(mode) {
            currentMode = mode;
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            if(mode === 'all') {
                document.getElementById('tabAll').classList.add('active');
                document.getElementById('importRow').style.display = 'flex';
                document.getElementById('searchInput').placeholder = "üîç Buscar en biblioteca...";
            } else {
                document.getElementById('tabFav').classList.add('active');
                document.getElementById('importRow').style.display = 'none';
                document.getElementById('searchInput').placeholder = "üîç Buscar en mi playlist...";
            }
            renderPlaylist();
        }

        function addToFav(index) {
            const track = fullPlaylist[index];
            if(!myPlaylist.find(t => t.url === track.url)) {
                myPlaylist.push(track);
                updateFavCount();
                // alert("A√±adida a Playlist ‚≠ê");
            }
        }

        function removeFromFav(index) {
            myPlaylist.splice(index, 1);
            updateFavCount();
            if(currentMode === 'fav') renderPlaylist();
        }
        
        function updateFavCount() { favCount.innerText = `(${myPlaylist.length})`; }

        function renderPlaylist() {
            const query = searchInput.value.toLowerCase();
            const source = currentMode === 'all' ? fullPlaylist : myPlaylist;
            playlistEl.innerHTML = "";
            activeQueue = source; 

            source.forEach((track, idx) => {
                if (query && !track.name.toLowerCase().includes(query)) return;
                
                const li = document.createElement('li');
                const isPlaying = (currentIndex === idx && source === activeQueue); 
                li.className = 'track-item' + (isPlaying ? ' active' : '');
                
                let actionBtn = "";
                if (currentMode === 'all') {
                    actionBtn = `<button class="add-btn" onclick="event.stopPropagation(); addToFav(${idx})" title="A√±adir a Playlist">+</button>`;
                } else {
                    actionBtn = `<button class="add-btn" onclick="event.stopPropagation(); removeFromFav(${idx})" title="Quitar">x</button>`;
                }

                li.innerHTML = `
                    <span class="track-num">${idx + 1}</span>
                    <span class="track-name">${track.name}</span>
                    ${actionBtn}
                `;
                li.onclick = () => loadTrack(idx);
                playlistEl.appendChild(li);
            });
            
            if (activeQueue.length === 0 && currentMode === 'fav') {
                playlistEl.innerHTML = '<li style="padding:20px; text-align:center; color:#888">Tu playlist est√° vac√≠a.</li>';
            }
        }

        function loadTrack(index) {
            if (index < 0 || index >= activeQueue.length) return;
            currentIndex = index;
            const track = activeQueue[index];
            audioPlayer.src = track.url;
            audioPlayer.play();
            trackTitle.innerText = track.name;
            renderPlaylist();
            
            if ('mediaSession' in navigator) {
                navigator.mediaSession.metadata = new MediaMetadata({
                    title: track.name, artist: 'THE rESEARCH BAND',
                    artwork: [{ src: 'PORTADA%20DISCO%20LP%20JAZZ1.png', sizes: '512x512', type: 'image/png' }]
                });
            }
        }
        
        function togglePlay() { if (audioPlayer.paused) audioPlayer.play(); else audioPlayer.pause(); }
        function nextTrack() {
            let next = currentIndex + 1;
            if (next >= activeQueue.length) next = 0;
            loadTrack(next);
        }
        function prevTrack() {
            let prev = currentIndex - 1;
            if (prev < 0) prev = activeQueue.length - 1;
            loadTrack(prev);
        }
        
        function filterPlaylist() { renderPlaylist(); }
        function searchWeb() {
            const query = searchInput.value;
            if (!query) return alert("Escribe algo para buscar.");
            window.open('https://www.youtube.com/results?search_query=' + encodeURIComponent(query), '_blank');
        }

        function importFiles(input) {
            const files = input.files;
            if (!files.length) return;
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                fullPlaylist.push({
                    name: file.name.replace(/\.[^/.]+$/, "").replace(/_/g, " "),
                    url: URL.createObjectURL(file), original: file.name
                });
            }
            alert(`¬°${files.length} canciones a√±adidas!`);
            renderPlaylist();
        }

        audioPlayer.addEventListener('ended', nextTrack);
        audioPlayer.onplay = () => coverDisplay.classList.add('playing');
        audioPlayer.onpause = () => coverDisplay.classList.remove('playing');

        renderPlaylist();
        if (fullPlaylist.length > 0) {
             currentIndex = 0;
             activeQueue = fullPlaylist;
             trackTitle.innerText = fullPlaylist[0].name;
             audioPlayer.src = fullPlaylist[0].url;
             renderPlaylist();
        }
    </script>
</body>
</html>
